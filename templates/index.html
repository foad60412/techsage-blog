<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>TechSage Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    :root {
      --main-bg: #fff;
      --main-text: #111;
      --accent: #ffd700;
      --card-bg: #fff;
      --banner-bg: #ffd700;
      --banner-text: #111;
    }
    [data-theme="dark"] {
      --main-bg: #111;
      --main-text: #fff;
      --accent: #ffd700;
      --card-bg: #181818;
      --banner-bg: #181818;
      --banner-text: #ffd700;
    }
    body {
      background: var(--main-bg);
      color: var(--main-text);
      min-height: 100vh;
      font-family: 'Segoe UI', sans-serif;
    }
    .navbar {
      background: var(--accent);
      border-bottom: 2px solid #222;
      box-shadow: none;
    }
    .navbar-brand {
      color: #111 !important;
      font-weight: bold;
      font-size: 2rem;
      letter-spacing: 1px;
    }
    .dark-toggle {
      color: #111;
      font-size: 1.4rem;
      border: none;
      background: transparent;
    }
    [data-theme="dark"] .navbar,
    [data-theme="dark"] .navbar-brand,
    [data-theme="dark"] .dark-toggle {
      background: #111;
      color: var(--accent) !important;
      border-bottom: 2px solid var(--accent);
    }
    /* إعلان */
    .ad-card {
      background: var(--card-bg);
      color: var(--main-text);
      border: 2px solid var(--accent);
      border-radius: 18px;
      font-size: 1.15rem;
      font-weight: 600;
      margin: 20px 0;
      box-shadow: 0 2px 14px #ffd7001a;
      text-align: center;
      padding: 28px 10px;
    }
    [data-theme="dark"] .ad-card {
      background: #181818;
      color: var(--accent);
      border-color: var(--accent);
    }
    /* Banner */
    .hero-banner {
      background: var(--banner-bg);
      color: var(--banner-text);
      border-radius: 22px;
      margin: 30px 0 24px 0;
      padding: 20px 30px;
      min-height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 4px 22px #ffd70011;
    }
    .carousel-inner {
      border-radius: 22px;
    }
    .carousel-caption {
      background: rgba(255,255,255,0.93);
      color: #111;
      border-radius: 1.3rem;
      padding: 12px 12px;
      left: 6% !important;
      right: 6% !important;
      bottom: 6% !important;
      width: 88%;
      box-shadow: 0 2px 10px #1113;
    }
    [data-theme="dark"] .carousel-caption {
      background: rgba(17,17,17,0.92);
      color: var(--accent);
    }
    .carousel-caption h5 {
      font-size: 1.3rem;
      font-weight: bold;
      color: #111;
      margin: 0;
    }
    [data-theme="dark"] .carousel-caption h5 {
      color: var(--accent);
    }
    .carousel-item img {
      border-radius: 22px;
      width: 100%;
      height: 250px;
      object-fit: cover;
    }
    @media (max-width: 800px) {
      .carousel-item img { height: 180px !important; }
      .hero-banner { font-size: 1.5rem; min-height: 120px; padding: 18px 8px;}
    }
    @media (max-width: 600px) {
      .carousel-item img { height: 130px !important; }
      .carousel-caption { padding: 5px 4px; left: 0 !important; right: 0 !important; width: 100%;}
      .hero-banner { font-size: 1.12rem; min-height: 90px;}
    }
    @media (max-width: 400px) {
      .carousel-item img { height: 92px !important; }
      .hero-banner { font-size: 1rem; min-height: 60px;}
    }
    /* Popular bar */
    .popular-bar-wrapper {
      overflow: hidden;
      background: var(--accent);
      border-radius: 0 0 2rem 2rem;
      position: relative;
      z-index: 10;
    }
    .popular-bar {
      display: flex;
      gap: 20px;
      animation: scroll-popular 22s linear infinite;
      min-width: 220%;
      align-items: center;
      padding: 10px 0;
    }
    @keyframes scroll-popular {
      0% {transform: translateX(0);}
      100% {transform: translateX(-50%);}
    }
    .popular-bar a {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #fff;
      color: #111;
      padding: 7px 22px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 1.03rem;
      text-decoration: none;
      border: 1px solid var(--accent);
      box-shadow: 0 2px 8px #ffd70022;
      white-space: nowrap;
      transition: background 0.18s, color 0.18s;
    }
    .popular-bar a:hover {
      background: var(--accent);
      color: #111;
      text-decoration: none;
    }
    [data-theme="dark"] .popular-bar-wrapper { background: #181818; }
    [data-theme="dark"] .popular-bar a {
      background: #222;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    /* قائمة المقالات */
    .card {
      border: none;
      border-radius: 18px;
      background: var(--card-bg);
      box-shadow: 0 2px 8px #ffd70013;
      transition: box-shadow 0.15s;
      color: var(--main-text);
      margin-bottom: 22px;
    }
    [data-theme="dark"] .card {
      background: #181818;
      color: #fff;
    }
    .card img {
      border-radius: 12px;
      height: 115px;
      object-fit: cover;
    }
    .card .text-muted {
      color: #222 !important;
    }
    [data-theme="dark"] .card .text-muted {
      color: var(--accent) !important;
      opacity: 0.8 !important;
    }
    .likes-badge {
      font-size: 1rem;
      color: #ca3c3c;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      font-weight: 600;
      text-shadow: 0 2px 8px #fff2;
    }
    /* قلب أسود فقط */
    .likes-badge .bi-heart-fill {
      color: #ff0000 !important;
    }
    .btn-outline-primary {
      border-color: var(--accent) !important;
      color: #111 !important;
      background: transparent !important;
      font-weight: bold;
    }
    .btn-outline-primary.active,
    .btn-outline-primary:active,
    .btn-outline-primary:focus,
    .btn-outline-primary:hover {
      background: var(--accent) !important;
      color: #111 !important;
      border-color: var(--accent) !important;
    }
    [data-theme="dark"] .btn-outline-primary {
      color: var(--accent) !important;
      border-color: var(--accent) !important;
      background: transparent !important;
    }
    [data-theme="dark"] .btn-outline-primary.active,
    [data-theme="dark"] .btn-outline-primary:active,
    [data-theme="dark"] .btn-outline-primary:focus,
    [data-theme="dark"] .btn-outline-primary:hover {
      background: var(--accent) !important;
      color: #181818 !important;
      border-color: var(--accent) !important;
    }
    .search-box input {
      width: 100%;
      border-radius: 8px;
      padding: 6px 12px;
      border: 1px solid var(--accent);
      font-size: 1rem;
      background: #fff;
      color: #111;
    }
    [data-theme="dark"] .search-box input {
      background: #181818;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    .filters-row {
      margin: 20px 0 10px 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
    }
    .btn-group {
      flex: 1 1 auto;
      min-width: 210px;
    }
    .search-box {
      flex: 1 1 160px;
      max-width: 240px;
    }
    .section-title {
      font-size: 1.18rem;
      margin-top: 18px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: .5px;
      text-shadow: 0 1px 4px #1111;
    }
    @media (max-width: 600px) {
      .popular-bar { font-size: 0.93rem; gap: 8px; }
      .card img { height: 62px; }
      .section-title { font-size: 1.03rem; }
      .card { padding: 0.52rem; }
    }
    @media (max-width: 450px) {
      .filters-row { flex-direction: column; gap: 7px;}
      .search-box { max-width: 100%; width: 100%; }
      .hero-banner, .carousel-item img { min-height: 56px; height: 80px !important;}
    }
  </style>
</head>
<body>
  <script src="https://fpyf8.com/88/tag.min.js" data-zone="148118" async data-cfasync="false"></script>
<nav class="navbar navbar-expand-lg px-3">
  <div class="container-fluid justify-content-between">
    <a class="navbar-brand mx-auto" href="/">TechSage</a>
    <button onclick="toggleTheme()" class="dark-toggle">
      <i class="bi bi-moon-stars-fill"></i>
    </button>
  </div>
</nav>

<!-- الإعلانات في الأعلى -->
{% for ad in top_ads %}
  <div class="ad-card">{{ ad.content|safe }}</div>
{% endfor %}

{% if popular_articles %}
<div class="popular-bar-wrapper">
  <div class="container-fluid px-0">
    <div class="popular-bar">
      {% for article in popular_articles %}
        <a href="{{ url_for('read_article', article_id=article.id) }}"><i class="bi bi-fire"></i>{{ article.title[:55] }}</a>
      {% endfor %}
      {% for article in popular_articles %}
        <a href="{{ url_for('read_article', article_id=article.id) }}"><i class="bi bi-fire"></i>{{ article.title[:55] }}</a>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

<!-- بنر متحرك (كاروسيل أو ثابت) -->
{% if articles|length > 2 %}
<div id="heroCarousel" class="carousel slide container mt-3" data-bs-ride="carousel">
  <div class="carousel-inner">
    {% for i in range(3) %}
    {% set hero = articles[i] %}
    <div class="carousel-item {% if i == 0 %}active{% endif %}">
      <a href="{{ url_for('read_article', article_id=hero.id) }}">
        {% if hero.image_url %}
        <img src="{{ hero.image_url }}" class="d-block w-100" alt="slide">
        {% endif %}
        <div class="carousel-caption d-block">
          <h5>{{ hero.title }}</h5>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>
{% endif %}

<div class="container">
  <div class="filters-row">
    <div class="btn-group" role="group">
      <a href="/?sort=latest" class="btn btn-outline-primary btn-sm {% if request.args.get('sort') == 'latest' or not request.args.get('sort') %}active{% endif %}">Latest</a>
      <a href="/?sort=likes" class="btn btn-outline-primary btn-sm {% if request.args.get('sort') == 'likes' %}active{% endif %}">Most Liked</a>
      <a href="/?sort=views" class="btn btn-outline-primary btn-sm {% if request.args.get('sort') == 'views' %}active{% endif %}">Most Viewed</a>
    </div>
    <form class="search-box" method="get" action="/">
      <input type="text" name="q" placeholder="Search articles..." value="{{ request.args.get('q', '') }}">
    </form>
  </div>
  <h4 class="section-title">Articles</h4>
  <div class="row mt-3">
    {% for article in articles[3:] %}
    <div class="col-12 col-md-6 col-lg-4 mb-4">
      <div class="card p-2">
        {% if article.image_url %}
        <img src="{{ article.image_url }}" class="img-fluid mb-2">
        {% endif %}
        <h6>{{ article.title }}</h6>
        <p class="small text-muted">{{ article.content[:100] }}...</p>
        <div class="likes-badge">
          <i class="bi bi-heart-fill"></i> {{ article.likes or 0 }} likes
        </div>
        <a href="{{ url_for('read_article', article_id=article.id) }}" class="btn btn-sm btn-outline-primary mt-2">Read More</a>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- إعلانات في الأسفل -->
  {% for ad in bottom_ads %}
    <div class="ad-card">{{ ad.content|safe }}</div>
  {% endfor %}
</div>

<script>
  function toggleTheme() {
    const current = document.documentElement.getAttribute("data-theme");
    const newTheme = current === "dark" ? "light" : "dark";
    document.documentElement.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
  }
  document.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem("theme");
    if (saved) document.documentElement.setAttribute("data-theme", saved);
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
